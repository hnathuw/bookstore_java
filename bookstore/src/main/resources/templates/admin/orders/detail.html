<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" th:href="@{/images/favicon.ico}">
    <title th:text="${'Chi ti·∫øt ƒë∆°n ' + (order != null ? order.orderNumber : '') + ' - Admin'}">Chi ti·∫øt ƒë∆°n - Admin</title>

    <!-- Bootstrap + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ‚úÖ CSS chung -->
    <link rel="stylesheet" th:href="@{/css/coquette-style.css}">
</head>
<body>
<div class="admin-container">

    <!-- SIDEBAR (gi·ªØ ƒë·ªìng nh·∫•t) -->
    <div class="sidebar">
        <h2><i class="fas fa-crown"></i> Admin</h2>
        <ul>
            <li><a href="/admin"><i class="fas fa-chart-line"></i> Dashboard</a></li>
            <li><a href="/admin/books"><i class="fas fa-book"></i> S√°ch</a></li>
            <li><a href="/admin/categories"><i class="fas fa-folder"></i> Danh m·ª•c</a></li>
            <li class="active"><a href="/admin/orders"><i class="fas fa-shopping-bag"></i> ƒê∆°n h√†ng</a></li>
            <li><a href="/admin/users"><i class="fas fa-users"></i> Ng∆∞·ªùi d√πng</a></li>
            <li><a href="/"><i class="fas fa-store"></i> Trang b√°n</a></li>
            <li>
                <!-- Gi·∫£ l·∫≠p link, th·ª±c ch·∫•t submit form POST -->
                <a href="#" onclick="document.getElementById('logoutForm').submit(); return false;">
                    <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                </a>

                <!-- Form POST ·∫©n -->
                <form id="logoutForm" th:action="@{/logout}" method="post" style="display:none;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                </form>
            </li>

        </ul>
    </div>

    <!-- MAIN -->
    <div class="admin-main">
        <div class="admin-header">
            <h2>
                <i class="fas fa-receipt"></i>
                Chi ti·∫øt ƒë∆°n
                <span class="text-muted">#<span th:text="${order.id}">0</span></span>
            </h2>
            <a class="btn btn-outline-secondary" th:href="@{/admin/orders}">
                <i class="fas fa-arrow-left"></i> Quay l·∫°i
            </a>
        </div>

        <div class="card-coquette mb-3">
            <div class="row g-3 p-3">
                <div class="col-md-6">
                    <div><span class="text-muted">M√£ ƒë∆°n:</span> <strong th:text="${order.orderNumber}">ORD-...</strong></div>
                    <div><span class="text-muted">Tr·∫°ng th√°i:</span>
                        <span class="status" th:text="${order.status}" th:classappend="' ' + ${order.status}">PLACED</span>
                    </div>
                    <div><span class="text-muted">Ng√†y t·∫°o:</span>
                        <span th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2025 12:00</span>
                    </div>
                    <div><span class="text-muted">T·ªïng ti·ªÅn (order.total):</span>
                        <strong th:text="|${order.total} ‚Ç´|">0 ‚Ç´</strong>
                    </div>
                </div>
                <div class="col-md-6">
                    <div><span class="text-muted">Kh√°ch h√†ng:</span> <strong th:text="${order.customerName}">Nguy·ªÖn VƒÉn A</strong></div>
                    <div><span class="text-muted">Li√™n h·ªá:</span>
                        <span th:text="${order.customerPhone}">0900000000</span> ¬∑
                        <span th:text="${order.customerEmail}">email@example.com</span>
                    </div>
                    <div><span class="text-muted">ƒê·ªãa ch·ªâ:</span> <span th:text="${order.shippingAddress}">...</span></div>
                    <div th:if="${order.notes}">
                        <span class="text-muted">Ghi ch√∫:</span> <span th:text="${order.notes}">...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- C·∫≠p nh·∫≠t tr·∫°ng th√°i -->
        <div class="card-coquette mb-3">
            <div class="p-3">
                <form class="d-inline" th:action="@{|/admin/orders/${order.id}/status|}" method="post">
                    <select class="form-select d-inline w-auto" name="status">
                        <option value="PLACED" th:selected="${order.status == 'PLACED'}">PLACED</option>
                        <option value="PAID" th:selected="${order.status == 'PAID'}">PAID</option>
                        <option value="SHIPPED" th:selected="${order.status == 'SHIPPED'}">SHIPPED</option>
                        <option value="DONE" th:selected="${order.status == 'DONE'}">DONE</option>
                        <option value="CANCELED" th:selected="${order.status == 'CANCELED'}">CANCELED</option>
                    </select>
                    <button class="btn btn-pink" type="submit"><i class="fas fa-save"></i> L∆∞u</button>
                </form>

                <form class="d-inline" th:action="@{|/admin/orders/${order.id}/delete|}" method="post"
                      onsubmit="return confirm('X√≥a ƒë∆°n n√†y?');">
                    <button class="btn btn-outline-danger" type="submit"><i class="fas fa-trash"></i> X√≥a ƒë∆°n</button>
                </form>
            </div>
        </div>

        <!-- Items -->
        <div class="card-coquette">
            <div class="table-responsive">
                <table class="table table-coquette align-middle">
                    <thead>
                    <tr>
                        <th>S·∫£n ph·∫©m</th>
                        <th class="text-end">ƒê∆°n gi√°</th>
                        <th class="text-end">SL</th>
                        <th class="text-end">Th√†nh ti·ªÅn</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(items)}">
                        <td colspan="4" class="text-center text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m.</td>
                    </tr>

                    <!-- üîß D√πng book.title thay cho productName ƒë·ªÉ tr√°nh l·ªói -->
                    <tr th:each="it : ${items}">
                        <td>
                            <div th:text="${it.book != null ? it.book.title : 'S·∫£n ph·∫©m'}">S√°ch A</div>
                            <div class="text-muted small">#<span th:text="${it.id}">0</span></div>
                        </td>
                        <td class="text-end" th:text="|${it.price} ‚Ç´|">0 ‚Ç´</td>
                        <td class="text-end" th:text="${it.quantity}">0</td>
                        <td class="text-end"
                            th:text="|${(it.price == null ? 0 : it.price) * (it.quantity == null ? 0 : it.quantity)} ‚Ç´|">0 ‚Ç´</td>
                    </tr>
                    </tbody>
                    <tfoot th:if="${items != null}">
                    <tr>
                        <th colspan="2" class="text-end">T·ªïng SL:</th>
                        <th class="text-end" th:text="${itemsTotalQty}">0</th>
                        <th></th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">T·ªïng ti·ªÅn (t·ª´ items):</th>
                        <th class="text-end" th:text="|${itemsTotalMoney} ‚Ç´|">0 ‚Ç´</th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">T·ªïng ti·ªÅn (order.total):</th>
                        <th class="text-end" th:text="|${order.total} ‚Ç´|">0 ‚Ç´</th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
